# Package

在工程化的 Go 语言开发项目中，Go 语言的源码复用是建立在包`package`基础之上的，本文介绍了 Go 语言中如何定义包、如何导出包的内容以及如何导入其他包。

`包package`是多个 Go 源码的集合，是一种高级的代码复用方案，Go 语言为我们提供了很多内置包，比如`fmt`，`os`，`io`等。

## 包的定义

我们可以根据自己的需求创建自己的包，一个包可以简单理解为一个存放`.go`文件的文件夹，该文件夹下面的所有 go 文件都要在代码的第一行添加如下代码，声明该文件归属的包：

```go
package 包名
```

**注意**

- 一个文件夹下面**_直接包含_**的文件只能归属于一个`package`，同样，一个`package`的文件不能放在多个文件夹下。
- 报名可以不和文件夹的名字一样，包名中不能包含`-`符号。
- 包名为`main`的包为应用程序的入口包，这种包编译后会得到一个可执行文件；编译不包含`main`包的源代码不会的到可执行文件。

## 包的可见性

如果想在一个包外引用另外一个包里的标识符（如变量、常量、类型、函数等）时，该标识符必须是对外可见的（public）。在 Go 语言中只需要将标识符的首字符大写就可以让标识符对外可见（public）了。

代码示例如下：

```go
package pkg2

import "fmt"

// 包变量可见性

var a = 100 // 首字母小写，外部包不可见，只能在当前包内使用

// 首字母大写外部包可见，可在其他包中使用
const Mode = 1

type person struct { // 首字母小写，外部包不可见，只能在当前包内使用
	name string
}

// 首字母大写，外部包可见，可在其他包中使用
func Add(x, y int) int {
	return x + y
}

func age() { // 首字母小写，外部包不可见，只能在当前包内使用
	var Age = 18 // 函数局部变量，外部包不可见，只能在当前函数内使用
	fmt.Println(Age)
}
```

结构体中的字段名和接口中的方法名，如果首字母都是大写，则外部包可以访问这些字段和方法，代码示例如下：

```go
type Student struct {
	Name  string //可在包外访问的方法
	class string //仅限包内访问的字段
}

type Payer interface {
	init() //仅限包内访问的方法
	Pay()  //可在包外访问的方法
}
```

## 包的导入

要在代码中引用其他包的内容，需要使用`import`关键字导入要使用的包。具体语法如下：

```go
import "包的路径"
```

**注意**：

- import 导入语句通常放在文件开头 包声明语句 的下面。
- 导入的包名或者包的路径需要使用双引号包裹起来。
- 导入的包的路径是从`$GOPATH/src/`后开始书写的，使用`/`进行路径的分隔。
- Go 语言中禁止循环导入包。

### 单行导入

单行导入的格式如下：

```go
import "包1"
import "包2"
```

### 多行导入

```go
import (
    "包1"
    "包2"
)
```

## 自定义包名

在导入包名的时候，我们可以为导入的包设置别名，通常用于导入的包名太长或者导入的包名冲突的时候。具体语法格式如下：

```go
import 别名 "包的路径/包名"
```

单行导入方式定义别名：

```go
import "fmt"
import m "github.com/Q1mi/studygo/pkg_test"

func main() {
	fmt.Println(m.Add(100, 200))
	fmt.Println(m.Mode)
}
```

多行导入方式定义别名：

```go
import (
    "fmt"
    m "github.com/Q1mi/studygo/pkg_test"
 )

func main() {
	fmt.Println(m.Add(100, 200))
	fmt.Println(m.Mode)
}
```

## 匿名导入包

如果只希望导入包，而不是使用包内的数据时，实际上是在导入包的时候执行包内的`init()`函数，可以使用匿名方式导入包。具体格式如下：

```go
import _ "包的路径/包名"
```

匿名导入的包与其他方式导入的包一样都会被编译到可执行文件中。

## init()初始化函数

### init()函数介绍

在 Go 语言程序执行时导入包语句会触发/调用/执行包内的`init()`函数，需要注意的是：`init()`函数没有参数也没有返回值，`init()`函数在程序运行时自动被调用执行，不能在代码中主动调用它。

一个包初始化时的执行顺序如图所示：

![包中的init()执行时机](https://www.liwenzhou.com/images/Go/package/init01.png)

### init()函数的执行顺序

Go 语言编译器会从`main`包开始检查其导入地所有包，每个包中又可能导入了其他的包。Go 编译器会由此构建出一个树状的包引用关系，再根据引用顺序决定编译顺序，依次编译这些包的代码。

在运行时，最后被导入的包会最先初始化并调用其`init()`函数，如下图所示：

![包之间的init()执行顺序](https://www.liwenzhou.com/images/Go/package/init02.png)
